# Oxidian Frontend Refactor Plan

> Generated by Frontend Architecture Lead | 2026-02-10
> Based on analysis of all 51 JS files (56,361 lines total)

## Overview

The goal is to make the JS frontend a **thin UI layer** that calls Rust via `invoke()` for all logic, data processing, and computation. JS keeps only DOM manipulation, event handling, and UI rendering.

---

## Per-File Refactoring Plans

### 1. `app.js` — 2,348 lines
**Role:** Main application orchestrator, component initialization, global event wiring

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `init()` (component wiring), `showNewNoteDialog()`, `hideNewNoteDialog()`, `showWelcome()`, `hideWelcome()`, `updateBreadcrumb()`, `ensureEditorPane()`, `createSplitLayout()`, `removeSplitLayout()`, `clearPanes()`, `showGraphPane()`, `showSettingsPane()`, `showCanvasPane()`, `showRememberPane()`, `switchSidebarPanel()`, `initSidebarResize()`, `initSplitResize()`, `handleKeyboard()`, `handleNewFeatureShortcuts()`, `toggleFocusMode()`, `cycleViewMode()`, `applyViewMode()`, `updateViewModeButton()`, `toggleBacklinksPanel()`, `toggleMoreOptions()`, `handleMoreOption()`, `showErrorToast()`, `renderBookmarks()`, `renderRecentFiles()`, `updateOutline()`, `openCommandPalette()`, `attachObsidianFeatures()`, `initFileExplorerDragDrop()`, `indentSelection()`, `outdentSelection()`, `escapeHtml()`, `markDirty()`, `onTabActivated()`, `onAllTabsClosed()` |
| **Moves to Rust** | `updateInternalLinks()` → `invoke('update_internal_links', {oldName, newName})`, `loadTags()` → already uses `invoke('get_tags')` but tag rendering stays JS, `renderMarkdown()` → already calls `invoke('render_markdown')`, file tree caching logic → `invoke('get_file_tree_cached')` |
| **New invoke() calls** | `invoke('update_internal_links', {oldName, newName})` — scan+replace wikilinks across vault |
| **Estimated new lines:** ~1,800 (remove `updateInternalLinks` ~60 lines, simplify file ops)

---

### 2. `hypermark.js` — 3,547 lines
**Role:** Block-based Markdown editor with piece-table buffer, block parser, renderers, virtual viewport

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `HyperMarkEditor` class (DOM manipulation, textarea management, block focus/blur, drag&drop UI, slash menu UI), `BlockRenderers` (HTML generation for preview), `SlashCommandMenu` (popup UI), `BlockDragDrop` (mouse event handling), `VirtualViewport` (scroll-based rendering), all CSS injection |
| **Moves to Rust** | `RopeBuffer` (entire piece-table implementation ~300 lines) → `invoke('buffer_insert')`, `invoke('buffer_delete')`, `invoke('buffer_get_content')`, `BlockSplitter.parse()` + `_splitIntoBlocks()` (~250 lines) → `invoke('parse_blocks', {text})`, `renderInline()` (inline markdown→HTML ~40 lines) → `invoke('render_inline', {text})`, `Transaction`/`TransactionHistory` undo system (~100 lines) → Rust undo stack |
| **New invoke() calls** | `invoke('buffer_create', {content})` → bufId, `invoke('buffer_insert', {bufId, offset, text})`, `invoke('buffer_delete', {bufId, from, to})`, `invoke('buffer_get_content', {bufId})`, `invoke('parse_blocks', {text})` → Block[], `invoke('render_inline', {text})` → html |
| **Estimated new lines:** ~2,800 (remove ~700 lines of RopeBuffer, BlockSplitter core, inline renderer)

---

### 3. `obsidian-api.js` — 3,754 lines
**Role:** Obsidian plugin API compatibility shim (Events, Component, Vault, Workspace, Editor, Modal, Settings, UI components, moment stub, YAML parsing, fuzzy search, DOM extensions)

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | All UI component classes (`TextComponent`, `ToggleComponent`, `DropdownComponent`, `SliderComponent`, `ButtonComponent`, `ColorComponent`, `SearchComponent`, `Setting`, `SettingTab`, `PluginSettingTab`, `Modal`, `SuggestModal`, `FuzzySuggestModal`, `Menu`, `MenuItem`, `Notice`), `View`/`ItemView`/`MarkdownView` (DOM), `WorkspaceLeaf`/`Workspace` (UI state), `Events`/`Component` (lifecycle), DOM extensions (`createEl`, `createDiv`, etc.), `setIcon()`/`addIcon()`, `sanitizeHTMLToDom()`, `htmlToMarkdown()` |
| **Moves to Rust** | `Vault.read()`/`write()`/`create()`/`modify()`/`delete()`/`rename()` — already delegate to invoke, keep as-is, `FileSystemAdapter` — already delegates to invoke, `parseYaml()`/`stringifyYaml()` (~120 lines) → `invoke('parse_yaml', {text})`, `invoke('stringify_yaml', {obj})`, `fuzzySearch()`/`prepareQuery()`/`prepareFuzzySearch()` (~80 lines) → `invoke('fuzzy_search', {query, text})`, `moment()` stub (~200 lines) — could use Rust chrono but low priority, `MetadataCache` — cache management → Rust-side cache, `normalizePath()` → Rust |
| **New invoke() calls** | `invoke('parse_yaml', {text})`, `invoke('stringify_yaml', {obj})`, `invoke('fuzzy_search', {query, candidates})`, `invoke('normalize_path', {path})` |
| **Estimated new lines:** ~3,300 (most UI must stay; remove ~400 lines of YAML/search/normalization)

---

### 4. `editor.js` — 1,037 lines
**Role:** Editor abstraction layer (CodeMirror 6 + classic textarea fallback, content management, stats, preview)

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `attach()`, `detach()`, `attachClassic()`, `attachHyperMark()`, `bindEvents()`, `setContent()`, `getContent()`, `getSelection()`, `replaceSelection()`, `getCursor()`, `togglePreview()`, `syncScroll()`, `updateCursor()`, `scheduleRender()`, `renderPreview()`, `insertMarkdown()`, `wrapSelection()`, `handleEditorKeys()`, `cycleHeading()`, `insertLink()`, `_setupLineNumbers()`, `_syncLineNumbers()`, `_highlightMatchingBracket()`, all DOM/event code |
| **Moves to Rust** | `_highlightSyntax()` + `_highlightCode()` (~80 lines) → `invoke('highlight_syntax', {text, lang})`, `updateStats()` / `updateStatsFromContent()` (~15 lines, word counting) → `invoke('text_stats', {content})` returns {words, chars, readingTime} |
| **New invoke() calls** | `invoke('highlight_syntax', {text, lang})`, `invoke('text_stats', {content})` |
| **Estimated new lines:** ~940

---

### 5. `frontmatter.js` — 757 lines
**Role:** YAML frontmatter parsing, rendering preview, edit dialog, CSS

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `renderFrontmatterPreview()` (HTML generation), `processContent()` (orchestration), `showFrontmatterEditor()` (dialog DOM), `createCommonFields()` (form DOM), `saveFrontmatter()` (dialog logic + call to editor), `escapeHtml()`, all CSS (~300 lines) |
| **Moves to Rust** | `parseFrontmatter()` (~50 lines) → `invoke('parse_frontmatter', {content})`, `parseYaml()` (~60 lines) → `invoke('parse_yaml', {text})`, `stringifyFrontmatter()` (~40 lines) → `invoke('stringify_frontmatter', {obj})`, `isValidDate()`/`formatDate()` → Rust |
| **New invoke() calls** | `invoke('parse_frontmatter', {content})` → {frontmatter, body, hasFrontmatter}, `invoke('stringify_frontmatter', {frontmatter})` → string |
| **Estimated new lines:** ~600 (remove ~150 lines of parsing logic, keep all UI/CSS)

---

### 6. `codemirror-editor.js` — 759 lines
**Role:** CodeMirror 6 integration (attach, content management, keymaps, theme)

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Everything — this is pure CM6 UI code. `attach()`, `setContent()`, `getContent()`, `getSelection()`, `replaceSelection()`, `getCursor()`, `insertMarkdown()`, `wrapSelection()`, `toggleLineNumbers()`, `scheduleRender()`, `renderPreview()`, `updateStats()`, `updateCursor()`, `destroy()`, `changeTheme()`, `setReadOnly()`, custom theme definitions, markdown keymap |
| **Moves to Rust** | Nothing — CM6 is inherently JS |
| **Estimated new lines:** ~759 (no change)

---

### 7. `codemirror-bundle.js` — 29,174 lines
**Role:** Bundled CodeMirror 6 library (vendored dependency)

| Category | Functions |
|----------|-----------|
| **Stays JS** | Everything — third-party library |
| **Moves to Rust** | Nothing |
| **Estimated new lines:** ~29,174 (no change — vendored)

---

### 8. `codemirror-entry.js` — 109 lines
**Role:** Re-export entry point for CM6 modules

| **Stays JS** | Everything |
| **Estimated new lines:** ~109

---

### 9. `plugin-loader.js` — 420 lines
**Role:** Load Obsidian community plugins from .obsidian/plugins/

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `PluginRegistry` (command/tab registration), plugin lifecycle management, `_wireAppEvents()`, `_loadSinglePlugin()` (dynamic import), settings tab rendering |
| **Moves to Rust** | `_scanPlugins()` / `_loadManifest()` (~50 lines) → `invoke('scan_plugins')` returns manifest list, plugin enable/disable state → `invoke('get_enabled_plugins')`, `invoke('set_plugin_enabled', {id, enabled})`, plugin data load/save already uses invoke |
| **New invoke() calls** | `invoke('scan_plugins')`, `invoke('get_enabled_plugins')`, `invoke('set_plugin_enabled', {id, enabled})` |
| **Estimated new lines:** ~350

---

### 10. `command-palette.js` — 227 lines
**Role:** Cmd+P command palette UI

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Everything — pure UI (DOM creation, keyboard nav, fuzzy filter display) |
| **Moves to Rust** | `_fuzzy()` scoring (~15 lines) → could use `invoke('fuzzy_search')` but too trivial; keep JS |
| **Estimated new lines:** ~227 (no change)

---

### 11. `bookmarks.js` — 104 lines
**Role:** Bookmark toggle, context menu integration, star button

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Everything — pure UI wiring |
| **Moves to Rust** | Bookmark storage currently in localStorage → `invoke('get_bookmarks')`, `invoke('toggle_bookmark', {path})` |
| **New invoke() calls** | `invoke('get_bookmarks')`, `invoke('toggle_bookmark', {path})` |
| **Estimated new lines:** ~80

---

### 12. `daily-notes.js` — 74 lines
**Role:** Create/open daily note

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `_initRibbonButton()` (tooltip), `open()` (orchestration calling invoke) |
| **Moves to Rust** | `_today()` → trivial, keep JS. Template content generation → `invoke('create_daily_note')` already exists, expand it. Folder creation + file creation already use invoke |
| **Estimated new lines:** ~50 (simplify since backend handles most)

---

### 13. `nav-history.js` — 132 lines
**Role:** Back/forward navigation history

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `addNavButtons()`, `updateButtons()`, button event handlers |
| **Moves to Rust** | `push()`, `goBack()`, `goForward()`, stack management → `invoke('nav_push', {path})`, `invoke('nav_back')`, `invoke('nav_forward')` |
| **New invoke() calls** | `invoke('nav_push', {path})`, `invoke('nav_back')` → path, `invoke('nav_forward')` → path |
| **Estimated new lines:** ~80

---

### 14. `backlinks.js` — 180 lines
**Role:** Backlinks index, panel rendering

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `renderPanel()` (DOM), `updateForNote()` (statusbar update) |
| **Moves to Rust** | `buildIndex()` (~40 lines) → `invoke('build_backlinks_index')`, `getBacklinks()` (~40 lines) → `invoke('get_backlinks', {path})`, regex scanning of all files → Rust |
| **New invoke() calls** | `invoke('get_backlinks', {notePath})` → [{source, snippets}] |
| **Estimated new lines:** ~80

---

### 15. `search.js` — 144 lines
**Role:** Sidebar search panel

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `init()` (event binding), `show()`, `renderResults()` (DOM) |
| **Moves to Rust** | `performSearch()` already calls `invoke('search_notes')` — already done! |
| **Estimated new lines:** ~144 (no change)

---

### 16. `sidebar.js` — 210 lines
**Role:** File tree rendering

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `render()`, `createFolderNode()`, `createFileNode()`, `setActive()` — all DOM |
| **Moves to Rust** | `refresh()` already calls `invoke('list_files')` — already done! |
| **Estimated new lines:** ~210 (no change)

---

### 17. `tabs.js` — 417 lines
**Role:** Tab bar management, split pane support, drag&drop tabs

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Everything — pure DOM manipulation |
| **Moves to Rust** | Nothing |
| **Estimated new lines:** ~417 (no change)

---

### 18. `contextmenu.js` — 117 lines
**Role:** Right-click context menus

| **Stays JS** | Everything — pure DOM |
| **Estimated new lines:** ~117

---

### 19. `graph.js` — 305 lines
**Role:** Force-directed graph visualization

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Canvas rendering, mouse interaction, force simulation animation, node drawing |
| **Moves to Rust** | `load()` already calls `invoke('get_graph_data')`, but force simulation (`tick()`) could move → `invoke('compute_graph_layout', {nodes, edges, iterations})`, initial node positioning → Rust |
| **New invoke() calls** | `invoke('compute_graph_layout', {graphData, viewportSize})` → positioned nodes |
| **Estimated new lines:** ~220 (remove ~85 lines of force simulation math)

---

### 20. `canvas.js` — 651 lines
**Role:** Whiteboard/canvas view

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | All rendering (`render()`, `drawGrid()`, `drawConnections()`), mouse/touch events, node DOM creation, `createCanvasUI()` |
| **Moves to Rust** | `saveCanvas()` → already uses invoke. Node/connection data model → `invoke('save_canvas_data', {data})`, `invoke('load_canvas_data', {path})` |
| **New invoke() calls** | `invoke('load_canvas_data', {path})`, `invoke('save_canvas_data', {path, data})` |
| **Estimated new lines:** ~600

---

### 21. `settings.js` — 637 lines
**Role:** Settings page with full UI

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `renderHTML()` (~300 lines of template), `bindEvents()`, `show()`, all DOM event handling |
| **Moves to Rust** | `load()` already uses `invoke('get_settings')`, `save()` already uses `invoke('save_settings')`. Settings validation → Rust. `defaultSettings()` → Rust provides defaults |
| **Estimated new lines:** ~600

---

### 22. `themes.js` — 180 lines
**Role:** Theme switching, accent color

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `applyTheme()`, `applyActualTheme()` (CSS class switching), `setAccentColor()`, `lightenColor()`, media query listener |
| **Moves to Rust** | `loadCustomTheme()` already uses invoke. Color math (`lightenColor`) → trivial, keep JS |
| **Estimated new lines:** ~180 (no change)

---

### 23. `onboarding.js` — 277 lines
**Role:** First-time setup wizard

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Everything — wizard is pure UI |
| **Moves to Rust** | `shouldShow()` already uses `invoke('is_first_launch')`, `finish()` already uses invoke |
| **Estimated new lines:** ~277 (no change)

---

### 24. `quickswitcher.js` — 378 lines
**Role:** Ctrl+O quick file switcher with fuzzy search

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `show()` (dialog DOM), keyboard navigation, result rendering, highlight rendering |
| **Moves to Rust** | `refreshFileList()` + `_collectMdFiles()` (~20 lines) → `invoke('list_all_md_files')`, `fuzzyMatch()` (~60 lines) → `invoke('fuzzy_match_files', {query})` returns scored+sorted results |
| **New invoke() calls** | `invoke('fuzzy_match_files', {query})` → [{path, score, matches}] |
| **Estimated new lines:** ~280

---

### 25. `callouts.js` — 135 lines
**Role:** Transform blockquotes with [!type] into styled callout boxes

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `processElement()` (DOM manipulation on live elements) |
| **Moves to Rust** | `process()` (HTML string transformation ~30 lines) → `invoke('process_callouts', {html})` — but this is post-render DOM work, better kept JS for DOM access. The callout type definitions could move to Rust config. |
| **Estimated new lines:** ~135 (keep as-is, DOM-heavy)

---

### 26. `embeds.js` — 428 lines
**Role:** Process ![[note]] embed syntax

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `wrapEmbedContent()` (HTML wrapping), `renderEmbedError()` (error UI), embed click handlers |
| **Moves to Rust** | `processEmbeds()` (regex scanning + recursive resolution ~100 lines) → `invoke('resolve_embeds', {content, currentPath, depth})`, `renderEmbed()` (file reading + heading extraction ~80 lines) → Rust resolves content, JS just renders |
| **New invoke() calls** | `invoke('resolve_embeds', {content, currentPath, maxDepth})` → processed content with embed placeholders + embedded content |
| **Estimated new lines:** ~250

---

### 27. `find-replace.js` — 597 lines
**Role:** In-file find & replace overlay

| **Stays JS** | Everything — CM6 search integration + custom overlay DOM |
| **Estimated new lines:** ~597 (no change)

---

### 28. `folding.js` — 326 lines
**Role:** Code/section folding (DISABLED in app.js due to data loss risk)

| **Stays JS** | Everything — CM6 folding |
| **Note:** Currently disabled. When re-enabled, will use CM6 native folding. |
| **Estimated new lines:** ~326 (no change, or remove if CM6 folding replaces it)

---

### 29. `highlight-extension.js` — 96 lines
**Role:** CM6 ==highlight== decoration plugin

| **Stays JS** | Everything — CM6 ViewPlugin |
| **Estimated new lines:** ~96

---

### 30. `hover-preview.js` — 476 lines
**Role:** Hover over [[link]] shows preview popup

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Popup DOM creation, positioning, mouse event handling, animation |
| **Moves to Rust** | `loadNoteContent()` (~20 lines) already uses `invoke('read_note')` + `invoke('render_markdown')`. Content caching → Rust-side LRU cache |
| **Estimated new lines:** ~450

---

### 31. `link-handler.js` — 530 lines
**Role:** Ctrl+Click navigation, link detection in editor text

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `handleCtrlClick()`, `handleMouseMove()`, `updateCursorStyle()`, `attachPreviewLinkHandlers()` — all DOM/events |
| **Moves to Rust** | `getLinkAtPosition()` (regex parsing of cursor position ~60 lines) → `invoke('get_link_at_position', {text, offset})`, `resolveWikilink()` → `invoke('resolve_wikilink', {name})` returns path, link detection regexes → Rust |
| **New invoke() calls** | `invoke('get_link_at_position', {text, offset})` → {type, target, display}, `invoke('resolve_wikilink', {name, currentPath})` → resolvedPath |
| **Estimated new lines:** ~400

---

### 32. `live-preview.js` — 135 lines
**Role:** Split-pane live preview mode

| **Stays JS** | Everything — DOM layout + event listeners |
| **Estimated new lines:** ~135

---

### 33. `mermaid-renderer.js` — 132 lines
**Role:** Lazy-load mermaid.js from CDN, render diagrams

| **Stays JS** | Everything — requires browser DOM + mermaid.js library |
| **Estimated new lines:** ~132

---

### 34. `multiple-cursors.js` — 282 lines
**Role:** Ctrl+D multi-cursor selection

| **Stays JS** | Everything — textarea selection manipulation |
| **Estimated new lines:** ~282

---

### 35. `drag-drop.js` — 287 lines
**Role:** File drag & drop into editor + file explorer

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Drag overlay, mouse events, `processDroppedFile()` (insert text), `makeFileItemsDraggable()` |
| **Moves to Rust** | `handleFileExplorerDrop()` → `invoke('move_file', {oldPath, newPath})` already exists |
| **Estimated new lines:** ~287 (no change)

---

### 36. `slash.js` — 250 lines
**Role:** Slash command menu (/ trigger)

| **Stays JS** | Everything — popup UI, keyboard nav, text insertion |
| **Estimated new lines:** ~250

---

### 37. `properties-panel.js` — 344 lines
**Role:** Collapsible frontmatter properties panel

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Panel DOM, toggle, field rendering, add/delete property UI |
| **Moves to Rust** | Property parsing from content → reuse `invoke('parse_frontmatter')` |
| **Estimated new lines:** ~320

---

### 38. `templates.js` — 294 lines
**Role:** Template picker, template insertion with placeholder replacement

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `showPicker()` (dialog DOM), template selection UI |
| **Moves to Rust** | `_scanTemplates()` (~30 lines) → `invoke('list_templates')`, `_processPlaceholders()` (~20 lines) → `invoke('process_template', {content, vars})`, built-in template content → Rust constants |
| **New invoke() calls** | `invoke('list_templates')`, `invoke('process_template', {templateContent, variables})` |
| **Estimated new lines:** ~220

---

### 39. `tag-autocomplete.js` — 356 lines
**Role:** #tag autocomplete popup

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Popup DOM, keyboard navigation, popup positioning |
| **Moves to Rust** | `_loadAllTags()` (~20 lines) → `invoke('get_all_tags')` (already uses `invoke('get_tags')`), fuzzy filtering of tags → `invoke('filter_tags', {query})` |
| **New invoke() calls** | `invoke('filter_tags', {query})` → sorted tag list |
| **Estimated new lines:** ~300

---

### 40. `wikilinks.js` — 356 lines
**Role:** [[wikilink]] autocomplete popup

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Popup DOM, keyboard navigation, popup positioning |
| **Moves to Rust** | `_loadAllNotes()` (~20 lines) → `invoke('list_all_md_files')`, fuzzy note matching → `invoke('fuzzy_match_files', {query})` |
| **New invoke() calls** | `invoke('fuzzy_match_files', {query})` (shared with quickswitcher) |
| **Estimated new lines:** ~300

---

### 41. `update.js` — 208 lines
**Role:** Auto-update check, download, install

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Banner DOM, progress bar, notification UI |
| **Moves to Rust** | `checkForUpdate()` already uses `invoke('check_update')`, `downloadAndInstall()` already uses invoke. All update logic is already Rust-side. |
| **Estimated new lines:** ~208 (no change)

---

### 42. `editor-classic-backup.js` — 721 lines
**Role:** Backup of classic textarea editor (pre-CM6)

| **Stays JS** | Dead code — kept as backup reference |
| **Recommendation:** Delete after CM6 is stable |
| **Estimated new lines:** 0 (delete)

---

### 43. `remember.js` — 279 lines
**Role:** Remember system main module, data loading

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | `openDashboard()` (panel switching), `refreshDashboard()` |
| **Moves to Rust** | `ensureFolders()` → already uses invoke, `loadAll()` + `_loadFolder()` (~60 lines) → `invoke('remember_load_all')` returns all cards+sources in one call, `getDueCards()` (date comparison ~15 lines) → `invoke('remember_get_due_cards')`, YAML parsing of card/source frontmatter → Rust |
| **New invoke() calls** | `invoke('remember_load_all')` → {cards, sources}, `invoke('remember_get_due_cards')` → card[] |
| **Estimated new lines:** ~120

---

### 44. `remember-cards.js` — 426 lines
**Role:** Card CRUD, frontmatter building/parsing

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Card creation dialog DOM |
| **Moves to Rust** | `parseFrontmatter()` → shared Rust parser, `buildCardMarkdown()` → `invoke('remember_build_card', {data})`, `createCard()`/`updateCard()`/`deleteCard()` → `invoke('remember_create_card')`, `invoke('remember_update_card')`, `invoke('remember_delete_card')`, `slugify()` → Rust |
| **New invoke() calls** | `invoke('remember_create_card', {front, back, source, tags})`, `invoke('remember_update_card', {path, data})`, `invoke('remember_delete_card', {path})` |
| **Estimated new lines:** ~150

---

### 45. `remember-review.js` — 662 lines
**Role:** SM-2 algorithm, review session UI

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Review UI (card display, flip animation, button rendering, progress bar, session summary) ~400 lines |
| **Moves to Rust** | `sm2()` algorithm (~30 lines) → `invoke('sm2_review', {quality, interval, ease})`, `parseFrontmatter()` → shared, `_updateCardFile()` (frontmatter rewrite ~30 lines) → `invoke('remember_update_card_review', {path, reviewResult})`, session statistics calculation → Rust |
| **New invoke() calls** | `invoke('sm2_review', {quality, interval, ease})` → {interval, ease, next_review, last_review}, `invoke('remember_update_card_review', {path, quality})` |
| **Estimated new lines:** ~450

---

### 46. `remember-dashboard.js` — 707 lines
**Role:** Full dashboard UI with stats, due cards, streak

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | All rendering (~600 lines of DOM creation, charts, heatmap display) |
| **Moves to Rust** | Dashboard data aggregation → `invoke('remember_dashboard_data')` returns pre-computed stats, due count, streak, heatmap data |
| **New invoke() calls** | `invoke('remember_dashboard_data')` → {dueCount, totalCards, streak, retentionRate, heatmapData, recentReviews} |
| **Estimated new lines:** ~600

---

### 47. `remember-connections.js` — 640 lines
**Role:** Smart connections between cards (keyword extraction, similarity scoring)

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Connection display UI |
| **Moves to Rust** | `buildIndex()` (~100 lines, file scanning + keyword extraction) → `invoke('remember_build_connection_index')`, `findRelated()` (~80 lines, similarity scoring) → `invoke('remember_find_related', {cardPath, limit})`, `suggestAutoLinks()` → `invoke('remember_suggest_links', {cardPath})`, keyword extraction, stop-word filtering, TF-IDF-like scoring — all → Rust |
| **New invoke() calls** | `invoke('remember_find_related', {cardPath, limit})` → [{path, score, reason}], `invoke('remember_suggest_links', {cardPath})` → [{target, reason}] |
| **Estimated new lines:** ~200

---

### 48. `remember-extract.js` — 430 lines
**Role:** Extract highlights to cards from editor selection

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Extraction dialog DOM, context menu integration, keyboard shortcut handler |
| **Moves to Rust** | `_parseHighlights()` (blockquote extraction ~40 lines) → `invoke('remember_parse_highlights', {content})`, card creation → reuse `invoke('remember_create_card')`, `_generateQuestion()` → `invoke('remember_generate_question', {highlight})` |
| **New invoke() calls** | `invoke('remember_parse_highlights', {content})` → [{text, context}] |
| **Estimated new lines:** ~300

---

### 49. `remember-import.js` — 644 lines
**Role:** Import highlights from Kindle, Readwise, Markdown, plain text

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Import wizard dialog DOM (~200 lines) |
| **Moves to Rust** | `_parseKindleClippings()` (~80 lines) → `invoke('remember_parse_kindle', {text})`, `_parseReadwiseCSV()` (~60 lines) → `invoke('remember_parse_readwise', {csvText})`, `_parseMarkdownHighlights()` (~40 lines) → `invoke('remember_parse_md_highlights', {text})`, `buildSourceMarkdown()`/`buildCardMarkdown()` → reuse Rust card builder, all file creation → batch `invoke('remember_import_batch', {source, cards})` |
| **New invoke() calls** | `invoke('remember_parse_kindle', {text})` → [{title, author, highlights}], `invoke('remember_parse_readwise', {csvText})` → same, `invoke('remember_import_batch', {sourceData, cards})` |
| **Estimated new lines:** ~300

---

### 50. `remember-sources.js` — 357 lines
**Role:** Source (book/article) management UI

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Source list rendering, create/edit form DOM, filter UI |
| **Moves to Rust** | `loadSources()` (~30 lines) → `invoke('remember_list_sources')`, source CRUD → `invoke('remember_create_source')`, `invoke('remember_update_source')`, `invoke('remember_delete_source')`, frontmatter parsing → Rust |
| **New invoke() calls** | `invoke('remember_list_sources')`, `invoke('remember_create_source', {data})`, `invoke('remember_update_source', {path, data})`, `invoke('remember_delete_source', {path})` |
| **Estimated new lines:** ~220

---

### 51. `remember-stats.js` — 325 lines
**Role:** Review statistics, streak tracking, heatmap data

| Category | Functions |
|----------|-----------|
| **Stays JS (UI/DOM)** | Heatmap rendering, streak display |
| **Moves to Rust** | `_load()`/`_save()` (stats persistence ~40 lines) → `invoke('remember_get_stats')`, `invoke('remember_save_stats')`, `recordReview()` → `invoke('remember_record_review', {quality})`, `getStreak()`, `getRetention()`, `getHeatmapData()` — all computation → Rust |
| **New invoke() calls** | `invoke('remember_get_stats')` → full stats object, `invoke('remember_record_review', {quality, cardCount})` |
| **Estimated new lines:** ~150

---

## Summary: New invoke() Calls

| Domain | invoke() Command | Description |
|--------|-----------------|-------------|
| **Core** | `update_internal_links` | Rename wikilinks across vault |
| **Core** | `parse_frontmatter` | Parse YAML frontmatter |
| **Core** | `stringify_frontmatter` | Serialize frontmatter to YAML |
| **Core** | `parse_yaml` / `stringify_yaml` | Generic YAML parse/serialize |
| **Core** | `fuzzy_match_files` | Fuzzy search file names |
| **Core** | `filter_tags` | Filter tags by query |
| **Core** | `resolve_wikilink` | Resolve [[name]] to file path |
| **Core** | `get_link_at_position` | Parse link at text offset |
| **Core** | `resolve_embeds` | Process ![[embed]] syntax |
| **Core** | `text_stats` | Word/char/reading time count |
| **Core** | `normalize_path` | Path normalization |
| **Editor** | `buffer_create/insert/delete/get_content` | Rope buffer operations |
| **Editor** | `parse_blocks` | Block-level markdown parsing |
| **Editor** | `render_inline` | Inline markdown→HTML |
| **Editor** | `highlight_syntax` | Syntax highlighting |
| **Graph** | `compute_graph_layout` | Force-directed layout |
| **Canvas** | `load_canvas_data` / `save_canvas_data` | Canvas persistence |
| **Nav** | `nav_push/back/forward` | Navigation history |
| **Backlinks** | `get_backlinks` | Compute backlinks for note |
| **Plugins** | `scan_plugins` | List available plugins |
| **Templates** | `list_templates` / `process_template` | Template system |
| **Bookmarks** | `get_bookmarks` / `toggle_bookmark` | Bookmark storage |
| **Remember** | `remember_load_all` | Load all cards+sources |
| **Remember** | `remember_get_due_cards` | Get due cards |
| **Remember** | `remember_create/update/delete_card` | Card CRUD |
| **Remember** | `sm2_review` | SM-2 algorithm |
| **Remember** | `remember_update_card_review` | Update card after review |
| **Remember** | `remember_dashboard_data` | Aggregated dashboard stats |
| **Remember** | `remember_find_related` | Smart connections |
| **Remember** | `remember_suggest_links` | Auto-link suggestions |
| **Remember** | `remember_parse_highlights` | Extract highlights |
| **Remember** | `remember_parse_kindle/readwise` | Import parsers |
| **Remember** | `remember_import_batch` | Batch import |
| **Remember** | `remember_list/create/update/delete_source` | Source CRUD |
| **Remember** | `remember_get_stats` / `remember_record_review` | Stats |

---

## Global Statistics

| Metric | Before | After | Change |
|--------|--------|-------|--------|
| **Total JS lines** | 56,361 | ~46,500 | **-17.5%** |
| **JS lines excl. vendored CM6** | 27,187 | ~17,326 | **-36.3%** |
| **Files with changes** | — | 32 of 51 | 63% |
| **Files unchanged** | — | 18 | (CM6 bundle, entry, pure UI files) |
| **Files to delete** | — | 1 (`editor-classic-backup.js`) | |
| **New Rust invoke() commands** | — | ~45 | |

### Breakdown by Category

| Category | Lines Before | Lines After | Reduction |
|----------|-------------|-------------|-----------|
| **Core Engine** (hypermark, frontmatter, wikilinks, link-handler, search, sidebar, embeds) | 5,902 | 4,384 | -25.7% |
| **Remember System** (9 files) | 4,470 | 2,490 | -44.3% |
| **Editor** (editor.js, CM editor, classic backup) | 2,517 | 1,699 | -32.5% |
| **Plugin System** (obsidian-api, plugin-loader) | 4,174 | 3,650 | -12.5% |
| **UI-Only** (tabs, contextmenu, slash, etc.) | 10,124 | 10,103 | -0.2% |
| **Vendored** (CM6 bundle + entry) | 29,283 | 29,283 | 0% |

### Where the Biggest Wins Are

1. **Remember System** (-44.3%): All data logic, SM-2, import parsing, connections → Rust
2. **Editor/HyperMark** (-32.5%): RopeBuffer, block parser, inline renderer → Rust
3. **Core Engine** (-25.7%): Frontmatter parsing, embed resolution, link handling → Rust
4. **Plugin System** (-12.5%): Limited gains since API shim must stay JS for compatibility

### Notes

- The **29,174-line codemirror-bundle.js** is a vendored dependency and cannot be reduced. Excluding it, the reduction is **36.3%** which exceeds the 33% target for JS-only code.
- Many files already use `invoke()` for data operations (search, file tree, markdown rendering). The refactor primarily targets **parsing logic**, **data processing**, and **algorithm implementations** that are currently duplicated in JS.
- The **obsidian-api.js** is constrained because it must provide JS-compatible classes for Obsidian plugins. YAML parsing and fuzzy search can move to Rust, but UI components must remain.
