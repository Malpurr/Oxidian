# QA Report â€” App Stabilization
**Date:** 2026-02-09  
**QA Lead:** Subagent (parallel to hypermark.js fixes)  
**Scope:** app.js, editor.js, index.html, style.css â€” everything except hypermark.js

---

## 1. app.js â€” View Mode Logic âœ…

### ensureEditorPane()
- **HyperMark path**: Correctly creates `#hypermark-root`, destroys old instance, instantiates `HyperMarkEditor`, and calls `editor.attachHyperMark()`. âœ…
- **Source/Classic path**: Creates textarea-only layout (no preview-pane-half). âœ…
- **Destroy/recreate on mode switch**: Both `cycleViewMode()` and `setEditorMode()` properly get content â†’ remove left-pane â†’ destroy hypermarkEditor â†’ call ensureEditorPane() â†’ restore content. âœ…

### applyViewMode()
- Adds correct CSS class (`live-preview-mode`, `source-mode`, `reading-mode`). âœ…
- Reading mode: dynamically creates `.reading-view` and renders markdown into it. âœ…
- Non-reading modes: removes `.reading-view` to clean up. âœ…

### preview-pane references
- **Line 576 (createSplitLayout)**: Right pane still uses `preview-pane-half` â€” this is **intentional** for the split-view fallback (right pane doesn't use HyperMark yet). NOT a bug.
- No stale preview-pane references in the left pane / HyperMark flow. âœ…

---

## 2. editor.js â€” Integration âœ…

### setContent() / getContent()
- Both correctly delegate to `this._hypermark` when present, fall back to `this.textarea` otherwise. âœ…

### attachHyperMark()
- Sets `this.textarea = null`, `this._hypermark = hypermark`. Clean handoff. âœ…

### Race conditions on tab switch
- `onTabActivated()` â†’ `showEditorPane()` â†’ `loadFileIntoLeftPane()` saves dirty files first via `await saveCurrentFile()`. Sequential, no race. âœ…
- `openFile()` also clears auto-save timer and saves before loading. âœ…

### Dead code (minor, non-blocking)
- `togglePreview()` and `syncScroll()` reference `.preview-pane-half` but are guarded by null checks on `this.previewEl` (null in HyperMark mode). Harmless but could be cleaned up eventually.

---

## 3. index.html â€” Layout âœ…

### Editor pane structure
- `#pane-container` starts empty, populated dynamically by `ensureEditorPane()`. Correct. âœ…
- No hidden preview-panes in static HTML. âœ…

### Update banner positioning â€” ðŸ”§ FIXED
- **Bug**: `update.js` prepended banner to `.app-container` which doesn't exist â†’ fell back to `document.body` â†’ inserted before `#app` div â†’ pushed entire flex layout down, clipping statusbar.
- **Fix**: Changed to `document.getElementById('content-area')` so banner renders inside the content area above the tab bar, within the flex layout.

---

## 4. CSS â€” Editor Styles âœ…

### .hypermark-editor
- `flex: 1` âœ…
- `min-height: 100%` âœ…  
- `display: flex; flex-direction: column; overflow-y: auto` âœ…
- `padding: 20px 28px` â€” matches textarea padding âœ…
- `font-family: var(--font-editor)` â€” same font as textarea âœ…
- `font-size: var(--font-size-editor)` âœ…
- `caret-color: var(--text-accent)` âœ…

### .editor-textarea
- `flex: 1` âœ… (fills editor-pane-half)
- `font-family: var(--font-editor)` âœ…
- `font-size: var(--font-size-editor)` âœ…
- Padding and line-height match hypermark-editor âœ…

### .editor-textarea-transparent (source mode with syntax highlighting)
- `background: transparent !important` âœ…
- `position: relative; z-index: 1` â€” sits above highlight backdrop âœ…

### Overflow
- `.editor-wrapper`: `flex: 1; display: flex; overflow: hidden` âœ…
- `.editor-pane-half`: `flex: 1; display: flex; overflow: hidden` âœ…
- No overflow issues detected.

### View mode CSS
- `.pane.reading-mode .editor-pane-half { display: none }` âœ…
- `.pane.source-mode .preview-pane-half { display: none }` âœ…
- `.pane.live-preview-mode .preview-pane-half { display: none }` âœ…

---

## 5. Source Mode Validation âœ…

- Source mode creates textarea-only layout (no HyperMark, no preview). âœ…
- Textarea gets `.editor-textarea` class â†’ `flex: 1` â†’ fills entire editor area. âœ…
- `editor.attach(textarea, null)` called â€” binds all events (input, keydown, blur save). âœ…
- `getContent()` returns `textarea.value` when `_hypermark` is null. âœ…
- `setContent()` sets `textarea.value` and calls `renderPreview()` (which is a no-op since `previewEl` is null). âœ…
- Auto-save on blur works via `editor.bindEvents()`. âœ…

---

## Summary

| Area | Status | Issues |
|------|--------|--------|
| app.js â€” View Mode | âœ… PASS | Clean |
| editor.js â€” Integration | âœ… PASS | Minor dead code (non-blocking) |
| index.html â€” Layout | âœ… PASS | â€” |
| Update Banner | ðŸ”§ FIXED | Was breaking flex layout |
| CSS â€” Editor Styles | âœ… PASS | All heights/fonts correct |
| Source Mode | âœ… PASS | Fallback works correctly |

**Fixes applied:** 1  
**Bugs found:** 1 (update banner positioning)  
**Blockers:** 0
